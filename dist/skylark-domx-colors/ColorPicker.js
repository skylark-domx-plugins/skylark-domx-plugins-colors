/**
 * skylark-domx-colors - The skylark dom api extenstion library for color
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-domx/skylark-domx-colors/
 * @license MIT
 */
define(["skylark-langx/langx","skylark-domx-browser","skylark-domx-noder","skylark-domx-finder","skylark-domx-query","skylark-domx-eventer","skylark-domx-styler","skylark-domx-plugins","skylark-graphics-color","./colors","./helper","./Indicator"],function(t,e,i,s,r,a,l,h,n,o,p,d){"use strict";var c=h.Plugin.inherit({klassName:"ColorPicker",pluginName:"domx.colors.picker",options:{selectors:{dragger:".sp-color",dragHelper:".sp-dragger",slider:".sp-hue",slideHelper:".sp-slider",alphaSliderInner:".sp-alpha-inner",alphaSlider:".sp-alpha",alphaSlideHelper:".sp-alpha-handle",textInput:".sp-input",initialColorContainer:".sp-initial",cancelButton:".sp-cancel",clearButton:".sp-clear",chooseButton:".sp-choose"},draggingClass:"sp-dragging",texts:{cancelText:"cancel",chooseText:"choose",clearText:"Clear Color Selection",noColorSelectedText:"No Color Selected"},states:{showInput:!1,allowEmpty:!1,showButtons:!0,showInitial:!1,showAlpha:!1},color:!1},_drawInitial:function(){var t=this.options;if(this.stating("showInitial")){var e=this._initialColor,i=this.get();this.$initialColorContainer.html(p.paletteTemplate([e,i],i,"sp-palette-row-initial",t))}},_updateHelperLocations:function(){var t=this._currentSaturation,e=this._currentValue;if(this.stating("allowEmpty")&&this._isEmpty)this.$alphaSlideHelper.hide(),this.$slideHelper.hide(),this.$dragHelper.hide();else{this.$alphaSlideHelper.show(),this.$slideHelper.show(),this.$dragHelper.show();var i=t*this._dragWidth,s=this._dragHeight-e*this._dragHeight;i=Math.max(-this._dragHelperHeight,Math.min(this._dragWidth-this._dragHelperHeight,i-this._dragHelperHeight)),s=Math.max(-this._dragHelperHeight,Math.min(this._dragHeight-this._dragHelperHeight,s-this._dragHelperHeight)),this.$dragHelper.css({top:s+"px",left:i+"px"});var r=this._currentAlpha*this._alphaWidth;this.$alphaSlideHelper.css({left:r-this._alphaSlideHelperWidth/2+"px"});var a=this._currentHue*this._slideHeight;this.$slideHelper.css({top:a-this._slideHelperHeight+"px"})}},_updateOriginalInput:function(t){var e=this.get(),i="";n.equals(e,this._colorOnShow);e&&(i=e.toString(this._currentPreferredFormat),this._addColorToSelectionPalette(e)),this._isInput&&this.$el.val(i)},_updateUI:function(){this.options;this._dragWidth=this.$dragger.width(),this._dragHeight=this.$dragger.height(),this._dragHelperHeight=this.$dragHelper.height(),this._slideWidth=this.$slider.width(),this._slideHeight=this.$slider.height(),this._slideHelperHeight=this.$slideHelper.height(),this._alphaWidth=this.$alphaSlider.width(),this._alphaSlideHelperWidth=this.$alphaSlideHelper.width(),this.$textInput.removeClass("sp-validation-error"),this._updateHelperLocations();var t=n.parse({h:360*this._currentHue,s:1,v:1});this.$dragger.css("background-color",t.toHexString());var i=this._currentPreferredFormat;this._currentAlpha<1&&(0!==this._currentAlpha||"name"!==i)&&("hex"!==i&&"hex3"!==i&&"hex6"!==i&&"name"!==i||(i="rgb"));var s=this.get({format:i}),r="";if(!s&&this.stating("allowEmpty"));else{var a=s.toHexString();s.toRgbString();if(this.stating("showAlpha")){var l=s.toRgb();l.a=0;var h=n.parse(l).toRgbString(),o="linear-gradient(left, "+h+", "+a+")";e.isIE?this.$alphaSliderInner.css("filter",n.parse(h).toFilter({gradientType:1},a)):(this.$alphaSliderInner.css("background","-webkit-"+o),this.$alphaSliderInner.css("background","-moz-"+o),this.$alphaSliderInner.css("background","-ms-"+o),this.$alphaSliderInner.css("background","linear-gradient(to right, "+h+", "+a+")"))}r=s.toString(i)}this.stating("showInput")&&this.$textInput.val(r),this.stating("showPalette")&&this._drawPalette(),this._drawInitial()},_applyOptions:function(){var t=this.options;this._states={allowEmpty:t.states.allowEmpty,showInput:t.states.showInput,showAlpha:t.states.showAlpha,showButtons:t.states.showButtons,showInitial:t.states.showInitial},this._applyStates(),this.reflow()},_construct:function(t,e){this.overrided(t,e);var i=this.$el=this.$(),s=this.options,r=(s.theme,this.$dragger=i.find(s.selectors.dragger),this.$dragHelper=i.find(s.selectors.dragHelper),this.$slider=i.find(s.selectors.slider),this.$slideHelper=i.find(s.selectors.slideHelper),this.$alphaSliderInner=i.find(s.selectors.alphaSliderInner),this.$alphaSlider=i.find(s.selectors.alphaSlider),this.$alphaSlideHelper=i.find(s.selectors.alphaSlideHelper),this.$textInput=i.find(s.selectors.textInput),this.$initialColorContainer=i.find(s.selectors.initialColorContainer),this.$cancelButton=i.find(s.selectors.cancelButton),this.$clearButton=i.find(s.selectors.clearButton),this.$chooseButton=i.find(s.selectors.chooseButton),this._initialColor=s.color);this._currentPreferredFormat=s.preferredFormat,this._isEmpty=!r;this._init()},_init:function(){var t=this,i=this.options;function s(){(t._dragHeight<=0||t._dragWidth<=0||t._slideHeight<=0)&&t.reflow(),t._isDragging=!0,t.$el.addClass(t.options.draggingClass),t._shiftMovementDirection=null}function l(){t._isDragging=!1,t.$el.removeClass(t.options.draggingClass)}function h(){t._updateUI()}function o(){var e=textInput.val();if(null!==e&&""!==e||!t._allowEmpty){var i=n.parse(e);i.isValid()?(t.set(i),h(),t._updateOriginalInput()):t.$textInput.addClass("sp-validation-error")}else t.set(null),h(),t._updateOriginalInput()}this._applyOptions(),this.$textInput.change(o),this.$textInput.on("paste",function(){setTimeout(o,1)}),this.$textInput.keydown(function(t){13==t.keyCode&&o()}),this.$cancelButton.text(i.texts.cancelText),this.listenTo(this.$cancelButton,"click",function(e){a.stop(e),t.revert(),t.hide()}),this.$clearButton.attr("title",i.texts.clearText),this.listenTo(this.$clearButton,"click",function(e){a.stop(e),t._isEmpty=!0,h(),i.flat&&t._updateOriginalInput(!0)}),this.$chooseButton.text(i.texts.chooseText),this.listenTo(this.$chooseButton,"click",function(e){a.stop(e),t._updateOriginalInput(!0),t.hide()}),this.$alphaSlider.plugin("domx.indicator",{onmove:function(e,i,s){t._currentAlpha=e/t._alphaWidth,t._isEmpty=!1,s.shiftKey&&(t._currentAlpha=Math.round(10*t._currentAlpha)/10),h()},onstart:s,onstop:l}),this.$slider.plugin("domx.indicator",{onmove:function(e,i,s){t._currentHue=parseFloat(i/t._slideHeight),t._isEmpty=!1,t.stating("showAlpha")||(t._currentAlpha=1),h()},onstart:s,onstop:l}),this.$dragger.plugin("domx.indicator",{onmove:function(e,i,s){if(s.shiftKey){if(!t._shiftMovementDirection){var r=t._currentSaturation*t._dragWidth,a=t._dragHeight-t._currentValue*t._dragHeight,l=Math.abs(e-r)>Math.abs(i-a);t._shiftMovementDirection=l?"x":"y"}}else t._shiftMovementDirection=null;var n=!t._shiftMovementDirection||"x"===t._shiftMovementDirection,o=!t._shiftMovementDirection||"y"===t._shiftMovementDirection;n&&(t._currentSaturation=parseFloat(e/t._dragWidth)),o&&(t._currentValue=parseFloat((t._dragHeight-i)/t._dragHeight)),t._isEmpty=!1,t.stating("showAlpha")||(t._currentAlpha=1),h()},onstart:s,onstop:l}),this._initialColor?(this.set(this._initialColor),t._updateUI(),this._currentPreferredFormat=i.preferredFormat||n.parse(this._initialColor).format):this._updateUI();var p=e.isIE?"mousedown.ColorPicker":"click.ColorPicker touchstart.ColorPicker";this.$initialColorContainer.on(p,".sp-thumb-el:nth-child(1)",{ignore:!0},function(e){return e.data&&e.data.ignore?(t.set(r(e.target).closest(".sp-thumb-el").data("color")),h()):(t.set(r(e.target).closest(".sp-thumb-el").data("color")),h(),i.hideAfterPaletteSelect?(self_updateOriginalInput(!0),t.hide()):t._updateOriginalInput()),!1})},revert:function(){this.set(this._initialColor,!0),this._updateOriginalInput(!0)},get:function(t){return t=t||{},this._allowEmpty&&this._isEmpty?null:n.parse({h:360*this._currentHue,s:this._currentSaturation,v:this._currentValue,a:Math.round(1e3*this._currentAlpha)/1e3})},set:function(t,e){var i,s,r=this.options;n.equals(t,this.get())?this._updateUI():(!t&&this.stating("allowEmpty")?this._isEmpty=!0:(this._isEmpty=!1,s=(i=n.parse(t)).toHsv(),this._currentHue=s.h%360/360,this._currentSaturation=s.s,this._currentValue=s.v,this._currentAlpha=s.a),this._updateUI(),i&&i.isValid()&&!e&&(this._currentPreferredFormat=r.preferredFormat||i.getFormat()))},_applyStates:function(){var t=this._states;this.$el.toggleClass("sp-input-disabled",!t.showInput).toggleClass("sp-clear-enabled",!!t.allowEmpty).toggleClass("sp-alpha-enabled",t.showAlpha).toggleClass("sp-buttons-disabled",!t.showButtons).toggleClass("sp-initial-disabled",!t.showInitial),t.allowEmpty||this.$clearButton.hide(),this._dragWidth=this.$dragger.width(),this._dragHeight=this.$dragger.height(),this._dragHelperHeight=this.$dragHelper.height(),this._slideWidth=this.$slider.width(),this._slideHeight=this.$slider.height(),this._slideHelperHeight=this.$slideHelper.height(),this._alphaWidth=this.$alphaSlider.width(),this._alphaSlideHelperWidth=this.$alphaSlideHelper.width()},stating:function(t,e){if(void 0===e)return this._states[t];this._states[t]=e,this._applyStates()},reflow:function(){this._updateHelperLocations()}});return h.register(c),o.ColorPicker=c});
//# sourceMappingURL=sourcemaps/ColorPicker.js.map
