{"version":3,"sources":["ColorPane.js"],"names":["define","skylark","langx","browser","noder","finder","$","eventer","styler","fx","plugins","popups","Color","colors","Indicator","noop","replaceInput","join","markup","paletteTemplate","p","color","className","opts","html","i","length","current","tiny","parse","c","toHsl","l","equals","formattedString","toString","preferredFormat","swatchStyle","toRgbString","push","append","attr","texts","noColorSelectedText","ColorPane","Plugin","inherit","klassName","pluginName","options","selectors","pickerContainer","dragger","dragHelper","slider","slideHelper","alphaSliderInner","alphaSlider","alphaSlideHelper","textInput","paletteContainer","initialColorContainer","cancelButton","clearButton","chooseButton","toggleButton","draggingClass","cancelText","chooseText","togglePaletteMoreText","togglePaletteLessText","clearText","layout","showInput","allowEmpty","showButtons","showInitial","showPalette","showPaletteOnly","showAlpha","togglePaletteOnly","showSelectionPalette","flat","clickoutFiresChange","hideAfterPaletteSelect","appendTo","maxSelectionSize","containerClassName","replacerClassName","theme","palette","selectionPalette","disabled","offset","_addColorToSelectionPalette","this","rgb","_paletteLookup","inArray","_selectionPalette","_maxSelectionSize","shift","getUniqueSelectionPalette","unique","stating","reverse","slice","_drawPalette","currentColor","get","map","_paletteArray","$paletteContainer","_drawInitial","initial","_colorOnShow","$initialColorContainer","_updateHelperLocations","s","_currentSaturation","v","_currentValue","_isEmpty","$alphaSlideHelper","hide","$slideHelper","$dragHelper","show","dragX","_dragWidth","dragY","_dragHeight","Math","max","_dragHelperHeight","min","css","top","left","alphaX","_currentAlpha","_alphaWidth","_alphaSlideHelperWidth","slideY","_slideHeight","_slideHelperHeight","_updateOriginalInput","fireCallback","displayColor","_currentPreferredFormat","_isInput","$el","val","_updateUI","$textInput","removeClass","flatColor","h","_currentHue","$dragger","toHexString","format","realColor","$previewElement","addClass","realHex","realRgb","toRgb","a","realAlpha","gradient","isIE","$alphaSliderInner","toFilter","gradientType","_applyOptions","_states","_palette","paletteArray","isArray","paletteLookup","j","$container","toggleClass","_applyStates","reflow","_construct","elm","overrided","element","_elm","doc","ownerDocument","container","body","isInput","$pickerContainer","find","$slider","$alphaSlider","$cancelButton","$clearButton","$chooseButton","$toggleButton","is","isInputTypeColor","inputTypeColorSupport","shouldReplace","_shouldReplace","replacer","$replacer","initialColor","$offsetElement","_initialColor","_allowEmpty","_init","self","dragStart","_isDragging","_shiftMovementDirection","dragStop","move","after","parent","setFromTextInput","value","isValid","set","paletteElementClick","e","data","ignore","target","closest","self_updateOriginalInput","listenTo","toggle","stopPropagation","preventDefault","change","on","setTimeout","keydown","keyCode","text","stop","revert","plugin","onmove","shiftKey","round","onstart","onstop","parseFloat","oldDragX","oldDragY","furtherFromX","abs","setSaturation","setValue","paletteEvent","ignoreFormatChange","newColor","newHsv","toHsv","getFormat","states","option","outerWidth","width","height","_slideWidth","name","undefined","calcOffset","_visible","_flat","destroy","off","remove","register","localization"],"mappings":"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","file":"../ColorPane.js","sourcesContent":["define([\r\n   \"skylark-langx/skylark\",\r\n    \"skylark-langx/langx\",\r\n    \"skylark-domx-browser\",\r\n    \"skylark-domx-noder\",\r\n    \"skylark-domx-finder\",\r\n    \"skylark-domx-query\",\r\n    \"skylark-domx-eventer\",\r\n    \"skylark-domx-styler\",\r\n    \"skylark-domx-fx\",\r\n    \"skylark-domx-plugins\",\r\n    \"skylark-domx-popups\",\r\n    \"skylark-graphics-color\",\r\n    \"./colors\",\r\n    \"./Indicator\"\r\n],function(skylark, langx, browser, noder, finder, $,eventer, styler,fx,plugins,popups,Color,colors,Indicator) {\r\n    \"use strict\";\r\n\r\n    var noop = langx.noop;\r\n\r\n    var pickers = [],\r\n    replaceInput = [\r\n        \"<div class='sp-replacer'>\",\r\n            \"<div class='sp-preview'><div class='sp-preview-inner'></div></div>\",\r\n            \"<div class='sp-dd'>&#9660;</div>\",\r\n        \"</div>\"\r\n    ].join(''),\r\n    \r\n    markup = (function () {\r\n        return [\r\n            \"<div class='sp-container sp-hidden'>\",\r\n                \"<div class='sp-palette-container'>\",\r\n                    \"<div class='sp-palette sp-thumb sp-cf'></div>\",\r\n                    \"<div class='sp-palette-button-container sp-cf'>\",\r\n                        \"<button type='button' class='sp-palette-toggle'></button>\",\r\n                    \"</div>\",\r\n                \"</div>\",\r\n                \"<div class='sp-picker-container'>\",\r\n                    \"<div class='sp-top sp-cf'>\",\r\n                        \"<div class='sp-fill'></div>\",\r\n                        \"<div class='sp-top-inner'>\",\r\n                            \"<div class='sp-color'>\",\r\n                                \"<div class='sp-sat'>\",\r\n                                    \"<div class='sp-val'>\",\r\n                                        \"<div class='sp-dragger'></div>\",\r\n                                    \"</div>\",\r\n                                \"</div>\",\r\n                            \"</div>\",\r\n                            \"<div class='sp-clear sp-clear-display'>\",\r\n                            \"</div>\",\r\n                            \"<div class='sp-hue'>\",\r\n                                \"<div class='sp-slider'></div>\",\r\n                            \"</div>\",\r\n                        \"</div>\",\r\n                        \"<div class='sp-alpha'><div class='sp-alpha-inner'><div class='sp-alpha-handle'></div></div></div>\",\r\n                    \"</div>\",\r\n                    \"<div class='sp-input-container sp-cf'>\",\r\n                        \"<input class='sp-input' type='text' spellcheck='false'  />\",\r\n                    \"</div>\",\r\n                    \"<div class='sp-initial sp-thumb sp-cf'></div>\",\r\n                    \"<div class='sp-button-container sp-cf'>\",\r\n                        \"<a class='sp-cancel' href='#'></a>\",\r\n                        \"<button type='button' class='sp-choose'></button>\",\r\n                    \"</div>\",\r\n                \"</div>\",\r\n            \"</div>\"\r\n        ].join(\"\");\r\n    })();\r\n\r\n    function paletteTemplate (p, color, className, opts) {\r\n        var html = [];\r\n        for (var i = 0; i < p.length; i++) {\r\n            var current = p[i];\r\n            if(current) {\r\n                var tiny = Color.parse(current);\r\n                var c = tiny.toHsl().l < 0.5 ? \"sp-thumb-el sp-thumb-dark\" : \"sp-thumb-el sp-thumb-light\";\r\n                c += (Color.equals(color, current)) ? \" sp-thumb-active\" : \"\";\r\n                var formattedString = tiny.toString(opts.preferredFormat || \"rgb\");\r\n                var swatchStyle = \"background-color:\" + tiny.toRgbString();\r\n                html.push('<span title=\"' + formattedString + '\" data-color=\"' + tiny.toRgbString() + '\" class=\"' + c + '\"><span class=\"sp-thumb-inner\" style=\"' + swatchStyle + ';\" /></span>');\r\n            } else {\r\n                var cls = 'sp-clear-display';\r\n                html.push($('<div />')\r\n                    .append($('<span data-color=\"\" style=\"background-color:transparent;\" class=\"' + cls + '\"></span>')\r\n                        .attr('title', opts.texts.noColorSelectedText)\r\n                    )\r\n                    .html()\r\n                );\r\n            }\r\n        }\r\n        return \"<div class='sp-cf \" + className + \"'>\" + html.join('') + \"</div>\";\r\n    }\r\n\r\n\r\n    var ColorPane = plugins.Plugin.inherit({\r\n        klassName : \"ColorPane\",\r\n\r\n        pluginName : \"domx.colors.pane\",\r\n\r\n        options : {\r\n            selectors  : {\r\n                pickerContainer : \".sp-picker-container\",\r\n                dragger : \".sp-color\",\r\n                dragHelper : \".sp-dragger\",\r\n                slider : \".sp-hue\",\r\n                slideHelper : \".sp-slider\",\r\n                alphaSliderInner : \".sp-alpha-inner\",\r\n                alphaSlider : \".sp-alpha\",\r\n                alphaSlideHelper : \".sp-alpha-handle\",\r\n                textInput : \".sp-input\",\r\n                paletteContainer : \".sp-palette\",\r\n                initialColorContainer : \".sp-initial\",\r\n                cancelButton : \".sp-cancel\",\r\n                clearButton : \".sp-clear\",\r\n                chooseButton : \".sp-choose\",\r\n                toggleButton : \".sp-palette-toggle\"\r\n            },\r\n\r\n            draggingClass : \"sp-dragging\",\r\n           \r\n\r\n            texts : {\r\n                cancelText: \"cancel\",\r\n                chooseText: \"choose\",\r\n                togglePaletteMoreText: \"more\",\r\n                togglePaletteLessText: \"less\",\r\n                clearText: \"Clear Color Selection\",\r\n                noColorSelectedText: \"No Color Selected\"\r\n            },\r\n\r\n            layout : {\r\n                showInput: false,\r\n                allowEmpty: false,\r\n                showButtons: true,\r\n                showInitial: false,\r\n                showPalette: false,\r\n                showPaletteOnly: false,\r\n                showAlpha: false,\r\n                togglePaletteOnly: false,\r\n                showSelectionPalette: true,\r\n            },\r\n\r\n\r\n            // Options\r\n            color: false,\r\n            flat: false,\r\n            clickoutFiresChange: true,\r\n            hideAfterPaletteSelect: false,\r\n            appendTo: \"body\",\r\n            maxSelectionSize: 7,\r\n            preferredFormat: false,\r\n            className: \"\", // Deprecated - use containerClassName and replacerClassName instead.\r\n            containerClassName: \"\",\r\n            replacerClassName: \"\",\r\n            theme: \"sp-light\",\r\n            palette: [\r\n                [\"#ffffff\", \"#000000\", \"#ff0000\", \"#ff8000\", \"#ffff00\", \"#008000\", \"#0000ff\", \"#4b0082\", \"#9400d3\"]\r\n            ],\r\n            selectionPalette: [],\r\n            disabled: false,\r\n            offset: null\r\n\r\n        },\r\n\r\n        _addColorToSelectionPalette : function (color) {\r\n            if (this.options.layout.showSelectionPalette) {\r\n                var rgb = Color.parse(color).toRgbString();\r\n                if (!this._paletteLookup[rgb] && langx.inArray(rgb, this._selectionPalette) === -1) {\r\n                    this._selectionPalette.push(rgb);\r\n                    while(this._selectionPalette.length > this._maxSelectionSize) {\r\n                        this._selectionPalette.shift();\r\n                    }\r\n                }\r\n            }\r\n        },\r\n\r\n        getUniqueSelectionPalette : function () {\r\n            var unique = [],\r\n                opts = this.options;\r\n            if (this.stating(\"showPalette\")) {\r\n                for (var i = 0; i < this._selectionPalette.length; i++) {\r\n                    var rgb = Color.parse(this._selectionPalette[i]).toRgbString();\r\n\r\n                    if (!this._paletteLookup[rgb]) {\r\n                        unique.push(this._selectionPalette[i]);\r\n                    }\r\n                }\r\n            }\r\n\r\n            return unique.reverse().slice(0, opts.maxSelectionSize);\r\n        },\r\n\r\n        _drawPalette : function () {\r\n\r\n            var opts = this.options,\r\n                currentColor = this.get();\r\n\r\n            var html = langx.map(this._paletteArray, function (palette, i) {\r\n                return paletteTemplate(palette, currentColor, \"sp-palette-row sp-palette-row-\" + i, opts);\r\n            });\r\n\r\n            if (this._selectionPalette) {\r\n                html.push(paletteTemplate(this.getUniqueSelectionPalette(), currentColor, \"sp-palette-row sp-palette-row-selection\", opts));\r\n            }\r\n\r\n            this.$paletteContainer.html(html.join(\"\"));\r\n        },\r\n\r\n        _drawInitial : function () {\r\n            var opts = this.options;\r\n            if (this.stating(\"showInitial\")) {\r\n                var initial = this._colorOnShow;\r\n                var current = this.get();\r\n                this.$initialColorContainer.html(paletteTemplate([initial, current], current, \"sp-palette-row-initial\", opts));\r\n            }\r\n        },\r\n\r\n        _updateHelperLocations : function () {\r\n            var s = this._currentSaturation;\r\n            var v = this._currentValue;\r\n\r\n            if(this.stating(\"allowEmpty\") && this._isEmpty) {\r\n                //if selected color is empty, hide the helpers\r\n                this.$alphaSlideHelper.hide();\r\n                this.$slideHelper.hide();\r\n                this.$dragHelper.hide();\r\n            }\r\n            else {\r\n                //make sure helpers are visible\r\n                this.$alphaSlideHelper.show();\r\n                this.$slideHelper.show();\r\n                this.$dragHelper.show();\r\n\r\n                // Where to show the little circle in that displays your current selected color\r\n                var dragX = s * this._dragWidth;\r\n                var dragY = this._dragHeight - (v * this._dragHeight);\r\n                dragX = Math.max(\r\n                    -this._dragHelperHeight,\r\n                    Math.min(this._dragWidth - this._dragHelperHeight, dragX - this._dragHelperHeight)\r\n                );\r\n                dragY = Math.max(\r\n                    -this._dragHelperHeight,\r\n                    Math.min(this._dragHeight - this._dragHelperHeight, dragY - this._dragHelperHeight)\r\n                );\r\n                this.$dragHelper.css({\r\n                    \"top\": dragY + \"px\",\r\n                    \"left\": dragX + \"px\"\r\n                });\r\n\r\n                var alphaX = this._currentAlpha * this._alphaWidth;\r\n                this.$alphaSlideHelper.css({\r\n                    \"left\": (alphaX - (this._alphaSlideHelperWidth / 2)) + \"px\"\r\n                });\r\n\r\n                // Where to show the bar that displays your current selected hue\r\n                var slideY = (this._currentHue) * this._slideHeight;\r\n                this.$slideHelper.css({\r\n                    \"top\": (slideY - this._slideHelperHeight) + \"px\"\r\n                });\r\n            }\r\n        },\r\n\r\n        _updateOriginalInput : function (fireCallback) {\r\n            var color = this.get(),\r\n                displayColor = '',\r\n                hasChanged = !Color.equals(color, this._colorOnShow);\r\n\r\n            if (color) {\r\n                displayColor = color.toString(this._currentPreferredFormat);\r\n                // Update the selection palette with the current color\r\n                this._addColorToSelectionPalette(color);\r\n            }\r\n\r\n            if (this._isInput) {\r\n                this.$el.val(displayColor);\r\n            }\r\n\r\n            if (fireCallback && hasChanged) {\r\n                //callbacks.change(color);\r\n                //this.$el.trigger('change', [ color ]);\r\n            }\r\n        },\r\n\r\n        _updateUI : function () {\r\n            var opts = this.options;\r\n\r\n            this.$textInput.removeClass(\"sp-validation-error\");\r\n\r\n            this._updateHelperLocations();\r\n\r\n            // Update dragger background color (gradients take care of saturation and value).\r\n            //var flatColor = Color.fromRatio({ h: currentHue, s: 1, v: 1 });\r\n            var flatColor = Color.parse({ \r\n                h: this._currentHue * 360, \r\n                s: 1, \r\n                v: 1 \r\n            });\r\n            this.$dragger.css(\"background-color\", flatColor.toHexString());\r\n\r\n            // Get a format that alpha will be included in (hex and names ignore alpha)\r\n            var format = this._currentPreferredFormat;\r\n            if (this._currentAlpha < 1 && !(this._currentAlpha === 0 && format === \"name\")) {\r\n                if (format === \"hex\" || format === \"hex3\" || format === \"hex6\" || format === \"name\") {\r\n                    format = \"rgb\";\r\n                }\r\n            }\r\n\r\n            var realColor = this.get({ format: format }),\r\n                displayColor = '';\r\n\r\n             //reset background info for preview element\r\n            this.$previewElement.removeClass(\"sp-clear-display\");\r\n            this.$previewElement.css('background-color', 'transparent');\r\n\r\n            if (!realColor && this.stating(\"allowEmpty\")) {\r\n                // Update the replaced elements background with icon indicating no color selection\r\n                this.$previewElement.addClass(\"sp-clear-display\");\r\n            }\r\n            else {\r\n                var realHex = realColor.toHexString(),\r\n                    realRgb = realColor.toRgbString();\r\n\r\n                // Update the replaced elements background color (with actual selected color)\r\n                this.$previewElement.css(\"background-color\", realRgb);\r\n\r\n                if (this.stating(\"showAlpha\")) {\r\n                    var rgb = realColor.toRgb();\r\n                    rgb.a = 0;\r\n                    var realAlpha = Color.parse(rgb).toRgbString();\r\n                    var gradient = \"linear-gradient(left, \" + realAlpha + \", \" + realHex + \")\";\r\n\r\n                    if (browser.isIE) {\r\n                        this.$alphaSliderInner.css(\"filter\", Color.parse(realAlpha).toFilter({ gradientType: 1 }, realHex));\r\n                    }\r\n                    else {\r\n                        this.$alphaSliderInner.css(\"background\", \"-webkit-\" + gradient);\r\n                        this.$alphaSliderInner.css(\"background\", \"-moz-\" + gradient);\r\n                        this.$alphaSliderInner.css(\"background\", \"-ms-\" + gradient);\r\n                        // Use current syntax gradient on unprefixed property.\r\n                        this.$alphaSliderInner.css(\"background\",\r\n                            \"linear-gradient(to right, \" + realAlpha + \", \" + realHex + \")\");\r\n                    }\r\n                }\r\n\r\n                displayColor = realColor.toString(format);\r\n            }\r\n\r\n            // Update the text entry input as it changes happen\r\n            if (this.stating(\"showInput\")) {\r\n                this.$textInput.val(displayColor);\r\n            }\r\n\r\n            if (this.stating(\"showPalette\")) {\r\n                this._drawPalette();\r\n            }\r\n\r\n            this._drawInitial();\r\n        },\r\n\r\n\r\n        _applyOptions : function () {\r\n            var opts = this.options;\r\n\r\n            this._states = {\r\n            \tallowEmpty : opts.layout.allowEmpty,\r\n                showInput : opts.layout.showInput,\r\n                showAlpha : opts.layout.showAlpha,\r\n                showButtons : opts.layout.showButtons,\r\n                togglePaletteOnly : opts.layout.togglePaletteOnly,\r\n                showPalette : opts.layout.showPalette,\r\n                showPaletteOnly : opts.layout.showPaletteOnly,\r\n                showInitial : opts.layout.showInitial\r\n            };\r\n\r\n\r\n            if (opts.palette) {\r\n                var  palette = this._palette = opts.palette.slice(0),\r\n                    paletteArray = this._paletteArray = langx.isArray(palette[0]) ? palette : [palette],\r\n                    paletteLookup = this._paletteLookup = {};\r\n                for (var i = 0; i < paletteArray.length; i++) {\r\n                    for (var j = 0; j < paletteArray[i].length; j++) {\r\n                        var rgb = Color.parse(paletteArray[i][j]).toRgbString();\r\n                        paletteLookup[rgb] = true;\r\n                    }\r\n                }\r\n            }\r\n\r\n            this.$container.toggleClass(\"sp-flat\", opts.flat)\r\n                           // .toggleClass(\"sp-input-disabled\", !opts.showInput)\r\n                           // .toggleClass(\"sp-alpha-enabled\", opts.showAlpha)\r\n                           // .toggleClass(\"sp-clear-enabled\", opts.allowEmpty)\r\n                           // .toggleClass(\"sp-buttons-disabled\", !opts.showButtons)\r\n                           // .toggleClass(\"sp-palette-buttons-disabled\", !opts.togglePaletteOnly)\r\n                           // .toggleClass(\"sp-palette-disabled\", !opts.showPalette)\r\n                           // .toggleClass(\"sp-palette-only\", opts.showPaletteOnly)\r\n                           // .toggleClass(\"sp-initial-disabled\", !opts.showInitial)\r\n                            .addClass(opts.className).addClass(opts.containerClassName);\r\n\r\n           this._applyStates();\r\n           this.reflow();\r\n        },\r\n\r\n         _construct: function(elm, options) {\r\n            this.overrided(elm,options);\r\n\r\n            this.$el = this.$();\r\n\r\n            var opts = this.options,\r\n\r\n                element = this._elm,\r\n                //flat = opts.flat,\r\n                ///showSelectionPalette = opts.showSelectionPalette,\r\n                theme = opts.theme,\r\n                //visible = false,\r\n                isDragging = false,\r\n                //dragWidth = 0,\r\n                //dragHeight = 0,\r\n                //dragHelperHeight = 0,\r\n                //slideHeight = 0,\r\n                //slideWidth = 0,\r\n                //alphaWidth = 0,\r\n                //alphaSlideHelperWidth = 0,\r\n                //slideHelperHeight = 0,\r\n                //currentHue = 0,\r\n                //currentSaturation = 0,\r\n                //currentValue = 0,\r\n                //currentAlpha = 1,\r\n                //palette = [],\r\n                //paletteArray = [],\r\n                //paletteLookup = {},\r\n\r\n                selectionPalette = this._selectionPalette =  opts.selectionPalette.slice(0);\r\n                //maxSelectionSize = opts.maxSelectionSize,\r\n                //shiftMovementDirection = null;\r\n\r\n\r\n            var doc = element.ownerDocument,\r\n                body = doc.body,\r\n                //boundElement = $(element),\r\n                disabled = false,\r\n                container = this.$container = $(markup, doc).addClass(theme),\r\n                pickerContainer = this.$pickerContainer =  container.find(opts.selectors.pickerContainer),\r\n                dragger = this.$dragger = container.find(opts.selectors.dragger),\r\n                dragHelper = this.$dragHelper = container.find(opts.selectors.dragHelper),\r\n                slider = this.$slider = container.find(opts.selectors.slider),\r\n                slideHelper = this.$slideHelper =  container.find(opts.selectors.slideHelper),\r\n                alphaSliderInner = this.$alphaSliderInner = container.find(opts.selectors.alphaSliderInner),\r\n                alphaSlider = this.$alphaSlider = container.find(opts.selectors.alphaSlider),\r\n                alphaSlideHelper = this.$alphaSlideHelper = container.find(opts.selectors.alphaSlideHelper),\r\n                textInput = this.$textInput = container.find(opts.selectors.textInput),\r\n                paletteContainer = this.$paletteContainer =  container.find(opts.selectors.paletteContainer),\r\n                initialColorContainer = this.$initialColorContainer = container.find(opts.selectors.initialColorContainer),\r\n                cancelButton = this.$cancelButton = container.find(opts.selectors.cancelButton),\r\n                clearButton = this.$clearButton = container.find(opts.selectors.clearButton),\r\n                chooseButton = this.$chooseButton = container.find(opts.selectors.chooseButton),\r\n                toggleButton = this.$toggleButton = container.find(opts.selectors.toggleButton),\r\n                isInput = this._isInput = this.$el.is(\"input\"),\r\n                isInputTypeColor = isInput && this.$el.attr(\"type\") === \"color\" && inputTypeColorSupport(),\r\n                shouldReplace = this._shouldReplace =  isInput && !opts.flat,\r\n                replacer = this.$replacer =  (shouldReplace) ? $(replaceInput).addClass(theme).addClass(opts.className).addClass(opts.replacerClassName) : $([]),\r\n                offsetElement = this.$offsetElement =  (shouldReplace) ? replacer : this.$el,\r\n                previewElement = this.$previewElement = replacer.find(\".sp-preview-inner\"),\r\n                initialColor = this._initialColor =  opts.color || (isInput && this.$el.val()),\r\n                colorOnShow = this._colorOnShow = false,\r\n                currentPreferredFormat = this._currentPreferredFormat = opts.preferredFormat,\r\n                //clickoutFiresChange = !this._states.showButtons || opts.clickoutFiresChange,\r\n                isEmpty = this._isEmpty =  !initialColor,\r\n                allowEmpty = this._allowEmpty = opts.allowEmpty && !isInputTypeColor;\r\n\r\n\r\n\r\n            function onkeydown(e) {\r\n                // Close on ESC\r\n                if (e.keyCode === 27) {\r\n                    hide();\r\n                }\r\n            }\r\n\r\n            function clickout(e) {\r\n                // Return on right click.\r\n                if (e.button == 2) { return; }\r\n\r\n                // If a drag event was happening during the mouseup, don't hide\r\n                // on click.\r\n                if (isDragging) { return; }\r\n\r\n                if (clickoutFiresChange) {\r\n                    updateOriginalInput(true);\r\n                }\r\n                else {\r\n                    revert();\r\n                }\r\n                hide();\r\n            }\r\n\r\n\r\n            function isValid() {\r\n                return !textInput.hasClass(\"sp-validation-error\");\r\n            }\r\n\r\n\r\n\r\n            this._init();\r\n\r\n            /*\r\n            langx.mixin(this, {\r\n\r\n                option: option,\r\n                set: function (c) {\r\n                    set(c);\r\n                    updateOriginalInput();\r\n                },\r\n                //get: get,\r\n                container: container\r\n            });\r\n            */\r\n        },\r\n\r\n        _init : function () {\r\n            var self = this,\r\n                opts = this.options;\r\n             function dragStart() {\r\n                if (self._dragHeight <= 0 || self._dragWidth <= 0 || self._slideHeight <= 0) {\r\n                    self.reflow();\r\n                }\r\n                self._isDragging = true;\r\n                self.$container.addClass(self.options.draggingClass);\r\n                self._shiftMovementDirection = null;\r\n                //this.$el.trigger('dragstart.ColorPane', [ get() ]);\r\n            }\r\n\r\n            function dragStop() {\r\n                self._isDragging = false;\r\n                self.$container.removeClass(self.options.draggingClass);\r\n                //this.$el.trigger('dragstop.ColorPane', [ get() ]);\r\n            }           \r\n\r\n            function move() {\r\n                self._updateUI();\r\n\r\n                //callbacks.move(get());\r\n                //this.$el.trigger('move.ColorPane', [ get() ]);\r\n            }\r\n\r\n            if (browser.isIE) {\r\n                this.$container.find(\"*:not(input)\").attr(\"unselectable\", \"on\");\r\n            }\r\n\r\n            this._applyOptions();\r\n\r\n            if (this._shouldReplace) {\r\n                this.$el.after(this.$replacer).hide();\r\n            }\r\n\r\n\r\n            if (opts.flat) {\r\n                this.$el.after(this.$container).hide();\r\n            } else {\r\n                var appendTo = opts.appendTo === \"parent\" ? this.$el.parent() : $(opts.appendTo);\r\n                if (appendTo.length !== 1) {\r\n                    appendTo = $(\"body\");\r\n                }\r\n\r\n                appendTo.append(this.$container);\r\n            }\r\n\r\n            this.listenTo(this.$offsetElement,\"click touchstart\", function (e) {\r\n                //if (!disabled) {\r\n                    self.toggle();\r\n                //}\r\n\r\n                e.stopPropagation();\r\n\r\n                if (!$(e.target).is(\"input\")) {\r\n                    e.preventDefault();\r\n                }\r\n            });\r\n\r\n            //if(this.$el.is(\":disabled\") || (opts.disabled === true)) {\r\n            //    disable();\r\n            //}\r\n\r\n            // Prevent clicks from bubbling up to document.  This would cause it to be hidden.\r\n            ///this.$container.click(stopPropagation);\r\n\r\n            // Handle user typed input\r\n            function setFromTextInput() {\r\n                var value = textInput.val();\r\n\r\n                if ((value === null || value === \"\") && self._allowEmpty) {\r\n                    self.set(null);\r\n                    move();\r\n                    self._updateOriginalInput();\r\n                }\r\n                else {\r\n                    var tiny = Color.parse(value);\r\n                    if (tiny.isValid()) {\r\n                        self.set(tiny);\r\n                        move();\r\n                        self._updateOriginalInput();\r\n                    }\r\n                    else {\r\n                        self.$textInput.addClass(\"sp-validation-error\");\r\n                    }\r\n                }\r\n            }\r\n            this.$textInput.change(setFromTextInput);\r\n            this.$textInput.on(\"paste\", function () {\r\n                setTimeout(setFromTextInput, 1);\r\n            });\r\n            this.$textInput.keydown(function (e) { if (e.keyCode == 13) { setFromTextInput(); } });\r\n\r\n            this.$cancelButton.text(opts.texts.cancelText);\r\n            \r\n            this.listenTo(this.$cancelButton,\"click\", function (e) {\r\n                //e.stopPropagation();\r\n                //e.preventDefault();\r\n                eventer.stop(e);\r\n                self.revert();\r\n                self.hide();\r\n            });\r\n\r\n            this.$clearButton.attr(\"title\", opts.texts.clearText);\r\n            this.listenTo(this.$clearButton,\"click\", function (e) {\r\n                //e.stopPropagation();\r\n                //e.preventDefault();\r\n                eventer.stop(e);\r\n                self._isEmpty = true;\r\n                move();\r\n\r\n                if(opts.flat) {\r\n                    //for the flat style, this is a change event\r\n                    self._updateOriginalInput(true);\r\n                }\r\n            });\r\n\r\n            this.$chooseButton.text(opts.texts.chooseText);\r\n            this.listenTo(this.$chooseButton,\"click\", function (e) {\r\n                //e.stopPropagation();\r\n                //e.preventDefault();\r\n                eventer.stop(e);\r\n\r\n                //if (browser.isIE && textInput.is(\":focus\")) {\r\n                //    textInput.trigger('change');\r\n                //}\r\n\r\n                if (isValid()) {\r\n                    self._updateOriginalInput(true);\r\n                    self.hide();\r\n                }\r\n            });\r\n          \r\n            this.listenTo(this.$toggleButton,\"click\", function (e) {\r\n                //e.stopPropagation();\r\n                //e.preventDefault();\r\n                eventer.stop(e);\r\n\r\n                ///self._states.showPaletteOnly = !self._states.showPaletteOnly;\r\n\r\n                // To make sure the Picker area is drawn on the right, next to the\r\n                // Palette area (and not below the palette), first move the Palette\r\n                // to the left to make space for the picker, plus 5px extra.\r\n                // The 'applyOptions' function puts the whole container back into place\r\n                // and takes care of the button-text and the sp-palette-only CSS class.\r\n                /*\r\n                if (!self._states.showPaletteOnly && !opts.flat) {\r\n                    self.$container.css('left', '-=' + (self.$pickerContainer.outerWidth(true) + 5));\r\n                }\r\n                */\r\n                self.stating(\"showPaletteOnly\",!self.stating(\"showPaletteOnly\"));\r\n                //self._applyOptions();\r\n            });\r\n\r\n            this.$alphaSlider.plugin(\"domx.indicator\", {\r\n                \"onmove\" :   function (dragX, dragY, e) {\r\n                    self._currentAlpha = (dragX / self._alphaWidth);\r\n                    self._isEmpty = false;\r\n                    if (e.shiftKey) {\r\n                        self._currentAlpha = Math.round(self._currentAlpha * 10) / 10;\r\n                    }\r\n\r\n                    move();\r\n                }, \r\n                \"onstart\" : dragStart, \r\n                \"onstop\" :dragStop\r\n            });\r\n\r\n            this.$slider.plugin(\"domx.indicator\", {\r\n                \"onmove\" :   function (dragX, dragY, e) {\r\n                    self._currentHue = parseFloat(dragY / self._slideHeight);\r\n                    self._isEmpty = false;\r\n                    if (!self.stating(\"showAlpha\")) {\r\n                        self._currentAlpha = 1;\r\n                    }\r\n                    move();\r\n                }, \r\n                \"onstart\" : dragStart, \r\n                \"onstop\" :dragStop\r\n            });\r\n\r\n            this.$dragger.plugin(\"domx.indicator\", {\r\n                \"onmove\" :   function (dragX, dragY, e) {\r\n\r\n                    // shift+drag should snap the movement to either the x or y axis.\r\n                    if (!e.shiftKey) {\r\n                        self._shiftMovementDirection = null;\r\n                    }\r\n                    else if (!self._shiftMovementDirection) {\r\n                        var oldDragX = self._currentSaturation * self._dragWidth;\r\n                        var oldDragY = self._dragHeight - (self._currentValue * self._dragHeight);\r\n                        var furtherFromX = Math.abs(dragX - oldDragX) > Math.abs(dragY - oldDragY);\r\n\r\n                        self._shiftMovementDirection = furtherFromX ? \"x\" : \"y\";\r\n                    }\r\n\r\n                    var setSaturation = !self._shiftMovementDirection || self._shiftMovementDirection === \"x\";\r\n                    var setValue = !self._shiftMovementDirection || self._shiftMovementDirection === \"y\";\r\n\r\n                    if (setSaturation) {\r\n                        self._currentSaturation = parseFloat(dragX / self._dragWidth);\r\n                    }\r\n                    if (setValue) {\r\n                        self._currentValue = parseFloat((self._dragHeight - dragY) / self._dragHeight);\r\n                    }\r\n\r\n                    self._isEmpty = false;\r\n                    if (!self.stating(\"showAlpha\")) {\r\n                        self._currentAlpha = 1;\r\n                    }\r\n\r\n                    move();\r\n                }, \r\n                \"onstart\" : dragStart, \r\n                \"onstop\" :dragStop\r\n            });\r\n\r\n            if (!!this._initialColor) {\r\n                this.set(this._initialColor);\r\n\r\n                // In case color was black - update the preview UI and set the format\r\n                // since the set function will not run (default color is black).\r\n                self._updateUI();\r\n                this._currentPreferredFormat = opts.preferredFormat || Color.parse(this._initialColor).format;\r\n\r\n                self._addColorToSelectionPalette(this._initialColor);\r\n            } else {\r\n                this._updateUI();\r\n            }\r\n\r\n            if (opts.flat) {\r\n                this.show();\r\n            }\r\n\r\n            function paletteElementClick(e) {\r\n                if (e.data && e.data.ignore) {\r\n                    self.set($(e.target).closest(\".sp-thumb-el\").data(\"color\"));\r\n                    move();\r\n                }\r\n                else {\r\n                    self.set($(e.target).closest(\".sp-thumb-el\").data(\"color\"));\r\n                    move();\r\n\r\n                    // If the picker is going to close immediately, a palette selection\r\n                    // is a change.  Otherwise, it's a move only.\r\n                    if (opts.hideAfterPaletteSelect) {\r\n                        self_updateOriginalInput(true);\r\n                        self.hide();\r\n                    } else {\r\n                        self._updateOriginalInput();\r\n                    }\r\n                }\r\n\r\n                return false;\r\n            }\r\n\r\n            var paletteEvent = browser.isIE ? \"mousedown.ColorPane\" : \"click.ColorPane touchstart.ColorPane\";\r\n            this.$paletteContainer.on(paletteEvent, \".sp-thumb-el\", paletteElementClick);\r\n            this.$initialColorContainer.on(paletteEvent, \".sp-thumb-el:nth-child(1)\", { ignore: true }, paletteElementClick);\r\n        },\r\n\r\n        revert :  function () {\r\n            this.set(this._colorOnShow, true);\r\n            this._updateOriginalInput(true);\r\n        },\r\n\r\n\r\n        get : function (opts) {\r\n            opts = opts || { };\r\n\r\n            if (this._allowEmpty && this._isEmpty) {\r\n                return null;\r\n            }\r\n\r\n            /*\r\n            return fromRatio({\r\n                h: currentHue,\r\n                s: currentSaturation,\r\n                v: currentValue,\r\n                a: Math.round(currentAlpha * 1000) / 1000\r\n            }, { format: opts.format || currentPreferredFormat });\r\n            */\r\n            return Color.parse({\r\n                h: this._currentHue * 360,\r\n                s: this._currentSaturation,\r\n                v: this._currentValue,\r\n                a: Math.round(this._currentAlpha * 1000) / 1000\r\n            });\r\n        },\r\n\r\n\r\n        set : function (color, ignoreFormatChange) {\r\n            var opts = this.options;\r\n\r\n            if (Color.equals(color, this.get())) {\r\n                // Update UI just in case a validation error needs\r\n                // to be cleared.\r\n                this._updateUI();\r\n                return;\r\n            }\r\n\r\n            var newColor, newHsv;\r\n            if (!color && this.stating(\"allowEmpty\")) {\r\n                this._isEmpty = true;\r\n            } else {\r\n                this._isEmpty = false;\r\n                newColor = Color.parse(color);\r\n                newHsv = newColor.toHsv();\r\n\r\n                this._currentHue = (newHsv.h % 360) / 360;\r\n                this._currentSaturation = newHsv.s;\r\n                this._currentValue = newHsv.v;\r\n                this._currentAlpha = newHsv.a;\r\n            }\r\n            this._updateUI();\r\n\r\n            if (newColor && newColor.isValid() && !ignoreFormatChange) {\r\n                this._currentPreferredFormat = opts.preferredFormat || newColor.getFormat();\r\n            }\r\n        },\r\n\r\n        _applyStates : function() {\r\n           var states = this._states ;\r\n\r\n            if (states.showPaletteOnly) {\r\n                states.showPalette = true;\r\n            }\r\n\r\n            this.$toggleButton.text(states.showPaletteOnly ? this.option(\"texts.togglePaletteMoreText\"): this.option(\"texts.togglePaletteLessText\"));\r\n\r\n\r\n            this.$container .toggleClass(\"sp-input-disabled\", !states.showInput)\r\n                            .toggleClass(\"sp-clear-enabled\", !!states.allowEmpty)\r\n                            .toggleClass(\"sp-alpha-enabled\", states.showAlpha)\r\n                            .toggleClass(\"sp-buttons-disabled\", !states.showButtons)\r\n                            .toggleClass(\"sp-palette-buttons-disabled\", !states.togglePaletteOnly)\r\n                            .toggleClass(\"sp-palette-disabled\", !states.showPalette)\r\n                            .toggleClass(\"sp-palette-only\", states.showPaletteOnly)\r\n                            .toggleClass(\"sp-initial-disabled\", !states.showInitial);\r\n\r\n            if (!states.allowEmpty) {\r\n                this.$clearButton.hide();\r\n            }\r\n\r\n            if (states.showPaletteOnly && !this.option(\"flat\")) {\r\n                this.$container.css('left', '-=' + (this.$pickerContainer.outerWidth(true) + 5));\r\n            }\r\n\r\n            this._dragWidth = this.$dragger.width();\r\n            this._dragHeight = this.$dragger.height();\r\n            this._dragHelperHeight = this.$dragHelper.height();\r\n            this._slideWidth = this.$slider.width();\r\n            this._slideHeight = this.$slider.height();\r\n            this._slideHelperHeight = this.$slideHelper.height();\r\n            this._alphaWidth = this.$alphaSlider.width();\r\n            this._alphaSlideHelperWidth = this.$alphaSlideHelper.width();\r\n        },\r\n\r\n        stating : function(name,value) {\r\n        \tif (value !== undefined) {\r\n        \t\tthis._states[name] = value;\r\n        \t\tthis._applyStates();\r\n        \t} else {\r\n        \t\treturn this._states[name];\r\n        \t}\r\n        },\r\n\r\n        reflow : function () {\r\n            //if (!this._visible) {\r\n            //    return; // Calculations would be useless and wouldn't be reliable anyways\r\n            //}\r\n\r\n\r\n            if (!this.option(\"flat\")) {\r\n                this.$container.css(\"position\", \"absolute\");\r\n                var offset = this.option(\"offset\"); \r\n                if (offset) {\r\n                    this.$container.offset(offset);\r\n                } else {\r\n                    this.$container.offset(popups.calcOffset(this.$container[0], this.$offsetElement[0]));\r\n                }\r\n            }\r\n\r\n            this._updateHelperLocations();\r\n\r\n            if (this.stating(\"showPalette\")) {\r\n                this._drawPalette();\r\n            }\r\n\r\n            //this.$el.trigger('reflow');\r\n        },\r\n\r\n        toggle : function () {\r\n            if (this._visible) {\r\n                this.hide();\r\n            } else {\r\n                this.show();\r\n            }\r\n        },\r\n\r\n        show : function () {\r\n            if (this._visible) {\r\n                this.reflow();\r\n                return;\r\n            }\r\n            \r\n            this._visible = true;\r\n\r\n            //$(doc).on(\"keydown.ColorPane\", onkeydown);\r\n            //$(doc).on(\"click.ColorPane\", clickout);\r\n            //$(window).on(\"resize.ColorPane\", resize);\r\n            this.$replacer.addClass(\"sp-active\");\r\n            this.$container.removeClass(\"sp-hidden\");\r\n\r\n            this.reflow();\r\n            \r\n            this._updateUI();\r\n\r\n            this._colorOnShow = this.get();\r\n\r\n            this._drawInitial();\r\n            \r\n        },\r\n        hide : function () {\r\n            // Return if hiding is unnecessary\r\n            if (!this._visible || this._flat) { return; }\r\n            this._visible = false;\r\n\r\n            //$(doc).off(\"keydown.ColorPane\", onkeydown);\r\n            //$(doc).off(\"click.ColorPane\", clickout);\r\n            //$(window).off(\"resize.ColorPane\", resize);\r\n\r\n            this.$replacer.removeClass(\"sp-active\");\r\n            this.$container.addClass(\"sp-hidden\");\r\n\r\n        },\r\n\r\n        destroy : function () {\r\n            this.$el.show();\r\n            this.$offsetElement.off(\"click.ColorPane touchstart.ColorPane\");\r\n            this.$container.remove();\r\n            this.$replacer.remove();\r\n            //pickers[spect.id] = null;\r\n        }\r\n\r\n    });\r\n\r\n\r\n    plugins.register(ColorPane);\r\n\r\n    ColorPane.localization = {};\r\n\r\n    return colors.ColorPane = ColorPane;\r\n\r\n});"]}