{"version":3,"sources":["ColorPalette.js"],"names":["define","skylark","langx","browser","noder","finder","$","eventer","styler","fx","plugins","Color","colors","helper","noop","ColorPalette","Plugin","inherit","klassName","pluginName","options","selectors","texts","states","palette","selectionPalette","_addColorToSelectionPalette","color","this","stating","rgb","parse","toRgbString","_paletteLookup","inArray","_selectionPalette","push","length","_maxSelectionSize","shift","getUniqueSelectionPalette","unique","opts","i","reverse","slice","maxSelectionSize","_drawPalette","currentColor","current","html","map","_paletteArray","paletteTemplate","$el","join","_updateUI","_applyOptions","_states","showSelectionPalette","_palette","paletteArray","isArray","paletteLookup","j","_applyStates","reflow","_construct","elm","overrided","_initialColor","_init","self","_currentPreferredFormat","preferredFormat","format","paletteEvent","isIE","on","e","target","closest","data","emit","name","value","undefined","_current","register"],"mappings":"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","file":"../ColorPalette.js","sourcesContent":["define([\r\n   \"skylark-langx/skylark\",\r\n    \"skylark-langx/langx\",\r\n    \"skylark-domx-browser\",\r\n    \"skylark-domx-noder\",\r\n    \"skylark-domx-finder\",\r\n    \"skylark-domx-query\",\r\n    \"skylark-domx-eventer\",\r\n    \"skylark-domx-styler\",\r\n    \"skylark-domx-fx\",\r\n    \"skylark-domx-plugins\",\r\n    \"skylark-graphics-color\",\r\n    \"./colors\",\r\n    \"./helper\"\r\n],function(skylark, langx, browser, noder, finder, $,eventer, styler,fx,plugins,Color,colors,helper) {\r\n    \"use strict\";\r\n\r\n    var noop = langx.noop;\r\n\r\n    var ColorPalette = plugins.Plugin.inherit({\r\n        klassName : \"ColorPalette\",\r\n\r\n        pluginName : \"domx.colors.palette\",\r\n\r\n        options : {\r\n            selectors  : {\r\n            },\r\n\r\n            texts : {\r\n            },\r\n\r\n            states : {\r\n            },\r\n            palette: [\r\n                [\"#ffffff\", \"#000000\", \"#ff0000\", \"#ff8000\", \"#ffff00\", \"#008000\", \"#0000ff\", \"#4b0082\", \"#9400d3\"]\r\n            ],\r\n            selectionPalette: []\r\n\r\n        },\r\n\r\n       _addColorToSelectionPalette : function (color) {\r\n            if (this.stating(\"showSelectionPalette\")) {\r\n                var rgb = Color.parse(color).toRgbString();\r\n                if (!this._paletteLookup[rgb] && langx.inArray(rgb, this._selectionPalette) === -1) {\r\n                    this._selectionPalette.push(rgb);\r\n                    while(this._selectionPalette.length > this._maxSelectionSize) {\r\n                        this._selectionPalette.shift();\r\n                    }\r\n                }\r\n            }\r\n        },  \r\n\r\n        getUniqueSelectionPalette : function () {\r\n            var unique = [],\r\n                opts = this.options;\r\n            if (this.stating(\"showPalette\")) {\r\n                for (var i = 0; i < this._selectionPalette.length; i++) {\r\n                    var rgb = Color.parse(this._selectionPalette[i]).toRgbString();\r\n\r\n                    if (!this._paletteLookup[rgb]) {\r\n                        unique.push(this._selectionPalette[i]);\r\n                    }\r\n                }\r\n            }\r\n\r\n            return unique.reverse().slice(0, opts.maxSelectionSize);\r\n        },\r\n\r\n        _drawPalette : function () {\r\n\r\n            var opts = this.options,\r\n                currentColor = this.current();\r\n\r\n            var html = langx.map(this._paletteArray, function (palette, i) {\r\n                return helper.paletteTemplate(palette, currentColor, \"sp-palette-row sp-palette-row-\" + i, opts);\r\n            });\r\n\r\n            if (this._selectionPalette) {\r\n                html.push(helper.paletteTemplate(this.getUniqueSelectionPalette(), currentColor, \"sp-palette-row sp-palette-row-selection\", opts));\r\n            }\r\n\r\n            this.$el.html(html.join(\"\"));\r\n        },\r\n\r\n\r\n        _updateUI : function () {\r\n           this._drawPalette();\r\n        },\r\n\r\n\r\n        _applyOptions : function () {\r\n            var opts = this.options;\r\n\r\n            this._states = {\r\n                showSelectionPalette: opts.showSelectionPalette\r\n            };            \r\n\r\n            if (opts.palette) {\r\n                var  palette = this._palette = opts.palette.slice(0),\r\n                    paletteArray = this._paletteArray = langx.isArray(palette[0]) ? palette : [palette],\r\n                    paletteLookup = this._paletteLookup = {};\r\n                for (var i = 0; i < paletteArray.length; i++) {\r\n                    for (var j = 0; j < paletteArray[i].length; j++) {\r\n                        var rgb = Color.parse(paletteArray[i][j]).toRgbString();\r\n                        paletteLookup[rgb] = true;\r\n                    }\r\n                }\r\n            }\r\n           this._applyStates();\r\n           this.reflow();\r\n        },\r\n\r\n         _construct: function(elm, options) {\r\n            this.overrided(elm,options);\r\n\r\n            this.$el = this.$();\r\n\r\n            var opts = this.options,\r\n                initialColor = this._initialColor =  opts.color,\r\n                selectionPalette = this._selectionPalette =  opts.selectionPalette.slice(0);\r\n\r\n            this._init();\r\n\r\n        },\r\n\r\n        _init : function () {\r\n            var self = this,\r\n                opts = this.options;\r\n            this._applyOptions();\r\n\r\n\r\n            if (!!this._initialColor) {\r\n                this.current(this._initialColor);\r\n\r\n                // In case color was black - update the preview UI and set the format\r\n                // since the set function will not run (default color is black).\r\n                self._updateUI();\r\n                this._currentPreferredFormat = opts.preferredFormat || Color.parse(this._initialColor).format;\r\n\r\n                self._addColorToSelectionPalette(this._initialColor);\r\n            } else {\r\n                this._updateUI();\r\n            }\r\n\r\n            function paletteElementClick(e) {\r\n                self.current($(e.target).closest(\".sp-thumb-el\").data(\"color\"));\r\n                self.emit(\"selected\",self.current());\r\n                return false;\r\n            }\r\n\r\n            var paletteEvent = browser.isIE ? \"mousedown.palette\" : \"click.palette touchstart.palette\";\r\n            this.$el.on(paletteEvent, \".sp-thumb-el\", paletteElementClick);\r\n        },\r\n\r\n\r\n        _applyStates : function() {\r\n\r\n        },\r\n\r\n        stating : function(name,value) {\r\n        \tif (value !== undefined) {\r\n        \t\tthis._states[name] = value;\r\n        \t\tthis._applyStates();\r\n        \t} else {\r\n        \t\treturn this._states[name];\r\n        \t}\r\n        },\r\n\r\n        reflow : function () {\r\n           this._drawPalette();\r\n        },\r\n\r\n        current : function(color) {\r\n        \tif (color === undefined) {\r\n        \t\treturn this._current;\r\n        \t} else {\r\n        \t\tthis._current = color;\r\n        \t}\r\n        }\r\n\r\n    });\r\n\r\n\r\n    plugins.register(ColorPalette);\r\n\r\n    return colors.ColorPalette = ColorPalette;\r\n\r\n});"]}