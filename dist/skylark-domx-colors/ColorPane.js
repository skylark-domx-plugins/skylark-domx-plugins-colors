/**
 * skylark-domx-colors - The skylark dom api extenstion library for color
 * @author Hudaokeji, Inc.
 * @version v0.9.0
 * @link https://github.com/skylark-domx/skylark-domx-colors/
 * @license MIT
 */
define(["skylark-langx/skylark","skylark-langx/langx","skylark-domx-browser","skylark-domx-noder","skylark-domx-finder","skylark-domx-query","skylark-domx-eventer","skylark-domx-styler","skylark-domx-fx","skylark-domx-plugins","skylark-domx-popups","skylark-graphics-color","./colors","./Indicator"],function(t,e,i,s,a,l,r,o,n,h,p,d,c,g){"use strict";e.noop;var u=["<div class='sp-replacer'>","<div class='sp-preview'><div class='sp-preview-inner'></div></div>","<div class='sp-dd'>&#9660;</div>","</div>"].join(""),f=["<div class='sp-container sp-hidden'>","<div class='sp-palette-container'>","<div class='sp-palette sp-thumb sp-cf'></div>","<div class='sp-palette-button-container sp-cf'>","<button type='button' class='sp-palette-toggle'></button>","</div>","</div>","<div class='sp-picker-container'>","<div class='sp-top sp-cf'>","<div class='sp-fill'></div>","<div class='sp-top-inner'>","<div class='sp-color'>","<div class='sp-sat'>","<div class='sp-val'>","<div class='sp-dragger'></div>","</div>","</div>","</div>","<div class='sp-clear sp-clear-display'>","</div>","<div class='sp-hue'>","<div class='sp-slider'></div>","</div>","</div>","<div class='sp-alpha'><div class='sp-alpha-inner'><div class='sp-alpha-handle'></div></div></div>","</div>","<div class='sp-input-container sp-cf'>","<input class='sp-input' type='text' spellcheck='false'  />","</div>","<div class='sp-initial sp-thumb sp-cf'></div>","<div class='sp-button-container sp-cf'>","<a class='sp-cancel' href='#'></a>","<button type='button' class='sp-choose'></button>","</div>","</div>","</div>"].join("");function _(t,e,i,s){for(var a=[],r=0;r<t.length;r++){var o=t[r];if(o){var n=d.parse(o),h=n.toHsl().l<.5?"sp-thumb-el sp-thumb-dark":"sp-thumb-el sp-thumb-light";h+=d.equals(e,o)?" sp-thumb-active":"";var p=n.toString(s.preferredFormat||"rgb"),c="background-color:"+n.toRgbString();a.push('<span title="'+p+'" data-color="'+n.toRgbString()+'" class="'+h+'"><span class="sp-thumb-inner" style="'+c+';" /></span>')}else{a.push(l("<div />").append(l('<span data-color="" style="background-color:transparent;" class="sp-clear-display"></span>').attr("title",s.texts.noColorSelectedText)).html())}}return"<div class='sp-cf "+i+"'>"+a.join("")+"</div>"}var v=h.Plugin.inherit({klassName:"ColorPane",pluginName:"domx.colors.pane",options:{selectors:{pickerContainer:".sp-picker-container",toggleButton:".sp-palette-toggle",paletteContainer:".sp-palette",dragger:".sp-color",dragHelper:".sp-dragger",slider:".sp-hue",slideHelper:".sp-slider",alphaSliderInner:".sp-alpha-inner",alphaSlider:".sp-alpha",alphaSlideHelper:".sp-alpha-handle",textInput:".sp-input",initialColorContainer:".sp-initial",cancelButton:".sp-cancel",clearButton:".sp-clear",chooseButton:".sp-choose"},draggingClass:"sp-dragging",texts:{cancelText:"cancel",chooseText:"choose",togglePaletteMoreText:"more",togglePaletteLessText:"less",clearText:"Clear Color Selection",noColorSelectedText:"No Color Selected"},states:{showPalette:!1,showPaletteOnly:!1,togglePaletteOnly:!1,showSelectionPalette:!0,showInput:!1,allowEmpty:!1,showButtons:!0,showInitial:!1,showAlpha:!1},color:!1,flat:!1,clickoutFiresChange:!0,hideAfterPaletteSelect:!1,appendTo:"body",maxSelectionSize:7,preferredFormat:!1,containerClassName:"",replacerClassName:"",theme:"sp-light",palette:[["#ffffff","#000000","#ff0000","#ff8000","#ffff00","#008000","#0000ff","#4b0082","#9400d3"]],selectionPalette:[],disabled:!1,offset:null},_addColorToSelectionPalette:function(t){if(this.stating("showSelectionPalette")){var i=d.parse(t).toRgbString();if(!this._paletteLookup[i]&&-1===e.inArray(i,this._selectionPalette))for(this._selectionPalette.push(i);this._selectionPalette.length>this._maxSelectionSize;)this._selectionPalette.shift()}},getUniqueSelectionPalette:function(){var t=[],e=this.options;if(this.stating("showPalette"))for(var i=0;i<this._selectionPalette.length;i++){var s=d.parse(this._selectionPalette[i]).toRgbString();this._paletteLookup[s]||t.push(this._selectionPalette[i])}return t.reverse().slice(0,e.maxSelectionSize)},_drawPalette:function(){var t=this.options,i=this.get(),s=e.map(this._paletteArray,function(e,s){return _(e,i,"sp-palette-row sp-palette-row-"+s,t)});this._selectionPalette&&s.push(_(this.getUniqueSelectionPalette(),i,"sp-palette-row sp-palette-row-selection",t)),this.$paletteContainer.html(s.join(""))},_drawInitial:function(){var t=this.options;if(this.stating("showInitial")){var e=this._colorOnShow,i=this.get();this.$initialColorContainer.html(_([e,i],i,"sp-palette-row-initial",t))}},_updateHelperLocations:function(){var t=this._currentSaturation,e=this._currentValue;if(this.stating("allowEmpty")&&this._isEmpty)this.$alphaSlideHelper.hide(),this.$slideHelper.hide(),this.$dragHelper.hide();else{this.$alphaSlideHelper.show(),this.$slideHelper.show(),this.$dragHelper.show();var i=t*this._dragWidth,s=this._dragHeight-e*this._dragHeight;i=Math.max(-this._dragHelperHeight,Math.min(this._dragWidth-this._dragHelperHeight,i-this._dragHelperHeight)),s=Math.max(-this._dragHelperHeight,Math.min(this._dragHeight-this._dragHelperHeight,s-this._dragHelperHeight)),this.$dragHelper.css({top:s+"px",left:i+"px"});var a=this._currentAlpha*this._alphaWidth;this.$alphaSlideHelper.css({left:a-this._alphaSlideHelperWidth/2+"px"});var l=this._currentHue*this._slideHeight;this.$slideHelper.css({top:l-this._slideHelperHeight+"px"})}},_updateOriginalInput:function(t){var e=this.get(),i="";d.equals(e,this._colorOnShow);e&&(i=e.toString(this._currentPreferredFormat),this._addColorToSelectionPalette(e)),this._isInput&&this.$el.val(i)},_updateUI:function(){this.options;this._dragWidth=this.$dragger.width(),this._dragHeight=this.$dragger.height(),this._dragHelperHeight=this.$dragHelper.height(),this._slideWidth=this.$slider.width(),this._slideHeight=this.$slider.height(),this._slideHelperHeight=this.$slideHelper.height(),this._alphaWidth=this.$alphaSlider.width(),this._alphaSlideHelperWidth=this.$alphaSlideHelper.width(),this.$textInput.removeClass("sp-validation-error"),this._updateHelperLocations();var t=d.parse({h:360*this._currentHue,s:1,v:1});this.$dragger.css("background-color",t.toHexString());var e=this._currentPreferredFormat;this._currentAlpha<1&&(0!==this._currentAlpha||"name"!==e)&&("hex"!==e&&"hex3"!==e&&"hex6"!==e&&"name"!==e||(e="rgb"));var s=this.get({format:e}),a="";if(this.$previewElement.removeClass("sp-clear-display"),this.$previewElement.css("background-color","transparent"),!s&&this.stating("allowEmpty"))this.$previewElement.addClass("sp-clear-display");else{var l=s.toHexString(),r=s.toRgbString();if(this.$previewElement.css("background-color",r),this.stating("showAlpha")){var o=s.toRgb();o.a=0;var n=d.parse(o).toRgbString(),h="linear-gradient(left, "+n+", "+l+")";i.isIE?this.$alphaSliderInner.css("filter",d.parse(n).toFilter({gradientType:1},l)):(this.$alphaSliderInner.css("background","-webkit-"+h),this.$alphaSliderInner.css("background","-moz-"+h),this.$alphaSliderInner.css("background","-ms-"+h),this.$alphaSliderInner.css("background","linear-gradient(to right, "+n+", "+l+")"))}a=s.toString(e)}this.stating("showInput")&&this.$textInput.val(a),this.stating("showPalette")&&this._drawPalette(),this._drawInitial()},_applyOptions:function(){var t=this.options;if(this._states={allowEmpty:t.states.allowEmpty,showInput:t.states.showInput,showAlpha:t.states.showAlpha,showButtons:t.states.showButtons,togglePaletteOnly:t.states.togglePaletteOnly,showPalette:t.states.showPalette,showPaletteOnly:t.states.showPaletteOnly,showInitial:t.states.showInitial},t.palette)for(var i=this._palette=t.palette.slice(0),s=this._paletteArray=e.isArray(i[0])?i:[i],a=this._paletteLookup={},l=0;l<s.length;l++)for(var r=0;r<s[l].length;r++){a[d.parse(s[l][r]).toRgbString()]=!0}this.$container.toggleClass("sp-flat",t.flat).addClass(t.containerClassName),this._applyStates(),this.reflow()},_construct:function(t,e){this.overrided(t,e),this.$el=this.$();var i=this.options,s=i.theme,a=(this._selectionPalette=i.selectionPalette.slice(0),this.$container=l(f,t.ownerDocument).addClass(s)),r=(this.$pickerContainer=a.find(i.selectors.pickerContainer),this.$dragger=a.find(i.selectors.dragger),this.$dragHelper=a.find(i.selectors.dragHelper),this.$slider=a.find(i.selectors.slider),this.$slideHelper=a.find(i.selectors.slideHelper),this.$alphaSliderInner=a.find(i.selectors.alphaSliderInner),this.$alphaSlider=a.find(i.selectors.alphaSlider),this.$alphaSlideHelper=a.find(i.selectors.alphaSlideHelper),this.$textInput=a.find(i.selectors.textInput),this.$paletteContainer=a.find(i.selectors.paletteContainer),this.$initialColorContainer=a.find(i.selectors.initialColorContainer),this.$cancelButton=a.find(i.selectors.cancelButton),this.$clearButton=a.find(i.selectors.clearButton),this.$chooseButton=a.find(i.selectors.chooseButton),this.$toggleButton=a.find(i.selectors.toggleButton),this._isInput=this.$el.is("input")),o=(r&&"color"===this.$el.attr("type")&&inputTypeColorSupport(),this._shouldReplace=r&&!i.flat),n=this.$replacer=o?l(u).addClass(s).addClass(i.className).addClass(i.replacerClassName):l([]),h=(this.$offsetElement=o?n:this.$el,this.$previewElement=n.find(".sp-preview-inner"),this._initialColor=i.color||r&&this.$el.val());this._colorOnShow=!1,this._currentPreferredFormat=i.preferredFormat,this._isEmpty=!h;this._init()},_init:function(){var t=this,e=this.options;function s(){(t._dragHeight<=0||t._dragWidth<=0||t._slideHeight<=0)&&t.reflow(),t._isDragging=!0,t.$container.addClass(t.options.draggingClass),t._shiftMovementDirection=null}function a(){t._isDragging=!1,t.$container.removeClass(t.options.draggingClass)}function o(){t._updateUI()}if(i.isIE&&this.$container.find("*:not(input)").attr("unselectable","on"),this._shouldReplace&&this.$el.after(this.$replacer).hide(),e.flat)this.$el.after(this.$container).hide();else{var n="parent"===e.appendTo?this.$el.parent():l(e.appendTo);1!==n.length&&(n=l("body")),n.append(this.$container)}function h(){var e=textInput.val();if(null!==e&&""!==e||!t._allowEmpty){var i=d.parse(e);i.isValid()?(t.set(i),o(),t._updateOriginalInput()):t.$textInput.addClass("sp-validation-error")}else t.set(null),o(),t._updateOriginalInput()}function p(i){return i.data&&i.data.ignore?(t.set(l(i.target).closest(".sp-thumb-el").data("color")),o()):(t.set(l(i.target).closest(".sp-thumb-el").data("color")),o(),e.hideAfterPaletteSelect?(self_updateOriginalInput(!0),t.hide()):t._updateOriginalInput()),!1}this._applyOptions(),this.listenTo(this.$offsetElement,"click touchstart",function(e){t.toggle(),e.stopPropagation(),l(e.target).is("input")||e.preventDefault()}),this.$textInput.change(h),this.$textInput.on("paste",function(){setTimeout(h,1)}),this.$textInput.keydown(function(t){13==t.keyCode&&h()}),this.$cancelButton.text(e.texts.cancelText),this.listenTo(this.$cancelButton,"click",function(e){r.stop(e),t.revert(),t.hide()}),this.$clearButton.attr("title",e.texts.clearText),this.listenTo(this.$clearButton,"click",function(i){r.stop(i),t._isEmpty=!0,o(),e.flat&&t._updateOriginalInput(!0)}),this.$chooseButton.text(e.texts.chooseText),this.listenTo(this.$chooseButton,"click",function(e){r.stop(e),isValid()&&(t._updateOriginalInput(!0),t.hide())}),this.listenTo(this.$toggleButton,"click",function(e){r.stop(e),t.stating("showPaletteOnly",!t.stating("showPaletteOnly"))}),this.$alphaSlider.plugin("domx.indicator",{onmove:function(e,i,s){t._currentAlpha=e/t._alphaWidth,t._isEmpty=!1,s.shiftKey&&(t._currentAlpha=Math.round(10*t._currentAlpha)/10),o()},onstart:s,onstop:a}),this.$slider.plugin("domx.indicator",{onmove:function(e,i,s){t._currentHue=parseFloat(i/t._slideHeight),t._isEmpty=!1,t.stating("showAlpha")||(t._currentAlpha=1),o()},onstart:s,onstop:a}),this.$dragger.plugin("domx.indicator",{onmove:function(e,i,s){if(s.shiftKey){if(!t._shiftMovementDirection){var a=t._currentSaturation*t._dragWidth,l=t._dragHeight-t._currentValue*t._dragHeight,r=Math.abs(e-a)>Math.abs(i-l);t._shiftMovementDirection=r?"x":"y"}}else t._shiftMovementDirection=null;var n=!t._shiftMovementDirection||"x"===t._shiftMovementDirection,h=!t._shiftMovementDirection||"y"===t._shiftMovementDirection;n&&(t._currentSaturation=parseFloat(e/t._dragWidth)),h&&(t._currentValue=parseFloat((t._dragHeight-i)/t._dragHeight)),t._isEmpty=!1,t.stating("showAlpha")||(t._currentAlpha=1),o()},onstart:s,onstop:a}),this._initialColor?(this.set(this._initialColor),t._updateUI(),this._currentPreferredFormat=e.preferredFormat||d.parse(this._initialColor).format,t._addColorToSelectionPalette(this._initialColor)):this._updateUI(),e.flat&&this.show();var c=i.isIE?"mousedown.ColorPane":"click.ColorPane touchstart.ColorPane";this.$paletteContainer.on(c,".sp-thumb-el",p),this.$initialColorContainer.on(c,".sp-thumb-el:nth-child(1)",{ignore:!0},p)},revert:function(){this.set(this._colorOnShow,!0),this._updateOriginalInput(!0)},get:function(t){return t=t||{},this._allowEmpty&&this._isEmpty?null:d.parse({h:360*this._currentHue,s:this._currentSaturation,v:this._currentValue,a:Math.round(1e3*this._currentAlpha)/1e3})},set:function(t,e){var i,s,a=this.options;d.equals(t,this.get())?this._updateUI():(!t&&this.stating("allowEmpty")?this._isEmpty=!0:(this._isEmpty=!1,s=(i=d.parse(t)).toHsv(),this._currentHue=s.h%360/360,this._currentSaturation=s.s,this._currentValue=s.v,this._currentAlpha=s.a),this._updateUI(),i&&i.isValid()&&!e&&(this._currentPreferredFormat=a.preferredFormat||i.getFormat()))},_applyStates:function(){var t=this._states;t.showPaletteOnly&&(t.showPalette=!0),this.$toggleButton.text(t.showPaletteOnly?this.option("texts.togglePaletteMoreText"):this.option("texts.togglePaletteLessText")),this.$container.toggleClass("sp-input-disabled",!t.showInput).toggleClass("sp-clear-enabled",!!t.allowEmpty).toggleClass("sp-alpha-enabled",t.showAlpha).toggleClass("sp-buttons-disabled",!t.showButtons).toggleClass("sp-palette-buttons-disabled",!t.togglePaletteOnly).toggleClass("sp-palette-disabled",!t.showPalette).toggleClass("sp-palette-only",t.showPaletteOnly).toggleClass("sp-initial-disabled",!t.showInitial),t.allowEmpty||this.$clearButton.hide(),t.showPaletteOnly&&!this.option("flat")&&this.$container.css("left","-="+(this.$pickerContainer.outerWidth(!0)+5)),this._dragWidth=this.$dragger.width(),this._dragHeight=this.$dragger.height(),this._dragHelperHeight=this.$dragHelper.height(),this._slideWidth=this.$slider.width(),this._slideHeight=this.$slider.height(),this._slideHelperHeight=this.$slideHelper.height(),this._alphaWidth=this.$alphaSlider.width(),this._alphaSlideHelperWidth=this.$alphaSlideHelper.width()},stating:function(t,e){if(void 0===e)return this._states[t];this._states[t]=e,this._applyStates()},reflow:function(){if(!this.option("flat")){this.$container.css("position","absolute");var t=this.option("offset");t?this.$container.offset(t):this.$container.offset(p.calcOffset(this.$container[0],this.$offsetElement[0]))}this._updateHelperLocations(),this.stating("showPalette")&&this._drawPalette()},toggle:function(){this._visible?this.hide():this.show()},show:function(){this._visible?this.reflow():(this._visible=!0,this.$replacer.addClass("sp-active"),this.$container.removeClass("sp-hidden"),this.reflow(),this._updateUI(),this._colorOnShow=this.get())},hide:function(){this._visible&&!this._flat&&(this._visible=!1,this.$replacer.removeClass("sp-active"),this.$container.addClass("sp-hidden"))},destroy:function(){this.$el.show(),this.$offsetElement.off("click.ColorPane touchstart.ColorPane"),this.$container.remove(),this.$replacer.remove()}});return h.register(v),v.localization={},c.ColorPane=v});
//# sourceMappingURL=sourcemaps/ColorPane.js.map
